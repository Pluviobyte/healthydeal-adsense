---
import ListingLayout from '../../layouts/ListingLayout.astro';
import { SECTION_COPY, getFeaturedPosts, getSectionPosts, getTagFilters } from '../../utils/content';
import { buildListingMeta, canonicalFromPath } from '../../utils/seo';
import { buildListingSchema } from '../../utils/schema';

const section = 'healthy-eating';
const [allPosts, featuredPosts] = await Promise.all([
  getSectionPosts(section),
  getFeaturedPosts(section)
]);
const featuredSlugs = new Set(featuredPosts.map((post) => post.slug));
const posts = allPosts.filter((post) => !featuredSlugs.has(post.slug));
const filters = getTagFilters(allPosts);

const site = Astro.site?.toString() ?? 'https://www.gencoser.com';
const url = canonicalFromPath(site, '/healthy-eating/');

const copy = SECTION_COPY[section];

const seo = buildListingMeta({
  title: `${copy.title} Guides & Grocery Lists`,
  description: copy.hero,
  url,
  keywords: ['healthy eating', 'balanced diet', 'grocery list', 'nutrition tips']
});

const structuredData = buildListingSchema({
  title: `${copy.title} Guides`,
  description: copy.description,
  url,
  items: allPosts,
  site
});
---
<ListingLayout
  title={`${copy.title}: Foundations & Grocery Lists`}
  description={copy.hero}
  section={section}
  posts={posts}
  featured={featuredPosts}
  canonical={seo.canonical}
  meta={seo.meta}
  structuredData={structuredData}
  filters={filters}
/>
