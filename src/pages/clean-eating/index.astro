---
import ListingLayout from '../../layouts/ListingLayout.astro';
import { SECTION_COPY, getFeaturedPosts, getSectionPosts, getTagFilters } from '../../utils/content';
import { buildListingMeta, canonicalFromPath } from '../../utils/seo';
import { buildListingSchema } from '../../utils/schema';

const section = 'clean-eating';
const [allPosts, featuredPosts] = await Promise.all([
  getSectionPosts(section),
  getFeaturedPosts(section)
]);

const featuredSlugs = new Set(featuredPosts.map((post) => post.slug));
const posts = allPosts.filter((post) => !featuredSlugs.has(post.slug));
const filters = getTagFilters(allPosts);

const site = Astro.site?.toString() ?? 'https://www.gencoser.com';
const url = canonicalFromPath(site, '/clean-eating/');

const copy = SECTION_COPY[section];

const seo = buildListingMeta({
  title: `${copy.title} Guides & Meal Plans`,
  description: copy.hero,
  url,
  keywords: ['clean eating', 'clean recipes', 'clean grocery list', 'whole foods']
});

const structuredData = buildListingSchema({
  title: `${copy.title} Collection`,
  description: copy.description,
  url,
  items: allPosts,
  site
});

const tabs = [
  { label: 'Food List', href: '/clean-eating/clean-eating-food-list/' },
  { label: 'Meal Plan', href: '/clean-eating/clean-eating-meal-plan/' },
  { label: 'Breakfast Ideas', href: '/clean-eating/clean-eating-breakfast-ideas/' },
  { label: 'Dinner Ideas', href: '/clean-eating/clean-eating-dinner-ideas/' }
];
---
<ListingLayout
  title={`${copy.title}: Meal Plans & Pantry Staples`}
  description={copy.hero}
  section={section}
  posts={posts}
  featured={featuredPosts}
  canonical={seo.canonical}
  meta={seo.meta}
  structuredData={structuredData}
  filters={filters}
  tabs={tabs}
/>
